# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- master

pr:
  branches:
    include:
    - '*'

variables:
  NODE_VERSION: '20.x'  # Node.js version to use.

pool:
  name: PoolRunners


stages:
- stage: Check
  displayName: 'Checking Stage'
  jobs:
  - job: Install Build Audit
    displayName: 'Install Dependencies & Build'
    steps:
    - task: NodeTool@0
      inputs:
        versionSpec: $(NODE_VERSION)
      displayName: 'Install Node.js'
    
    - script: |
        npm ci
      displayName: 'Clean install'
    
    - script: |
        npm test || echo 'Script not found'
      displayName: 'Test the code'
    
    - script: |
        npm run build --prod
      displayName: 'Build the code'
    
    - script: |
        npm audit --prod
      displayName: 'Audit the code'

    - script: |
        VAR_BUILD_ID = $BuildID
        echo 'Build ID: $VAR_BUILD_ID'
      displayName: 'Save Build ID'
